<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TabFlow</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for tab editor precision and print */
    .tab-editor {
      font-size: 14pt;
      line-height: 1.2;
      white-space: pre;
      overflow-wrap: break-word;
    }

    .editable-char {
      background: #f39c12 !important;
      color: white !important;
      border-radius: 2px;
    }

    /* Print Styles */
    @media print {
      body {
        margin: 0 !important;
        padding: 0 !important;
        background: white !important;
      }

      .app-container {
        box-shadow: none !important;
        border-radius: 0 !important;
        max-width: none !important;
      }

      .no-print {
        display: none !important;
      }
    }
  </style>


</head>

<body class="font-sans m-0 p-5 bg-gray-100">
  <div class="app-container mx-auto bg-white shadow-lg rounded overflow-hidden">
    <div
      class="toolbar no-print p-4 px-5 bg-slate-700 text-white flex gap-4 items-center flex-wrap">
      <h1 class="m-0 text-2xl text-white">TabFlow</h1>


      <div class="toolbar-group flex gap-2.5 items-center">
        <label for="stringCount" class="font-bold">Strings:</label>
        <select id="stringCount"
          class="py-1 px-2.5 border-none rounded bg-white cursor-pointer text-black">
          <option value="4">4 (Bass)</option>
          <option value="5">5 (Bass)</option>
          <option value="6" selected>6 (Guitar)</option>
          <option value="7">7 (Guitar)</option>
          <option value="8">8 (Guitar)</option>
        </select>
      </div>

      <div class="toolbar-group flex gap-2.5 items-center">
        <label for="fontSize" class="font-bold">Font Size:</label>
        <select id="fontSize"
          class="py-1 px-2.5 border-none rounded bg-white cursor-pointer text-black">
          <option value="10">10pt</option>
          <option value="12">12pt</option>
          <option value="14" selected>14pt</option>
          <option value="16">16pt</option>
          <option value="18">18pt</option>
        </select>
      </div>

      <div class="toolbar-group flex gap-2.5 items-center">
        <button id="saveTab"
          class="py-1 px-2.5 border-none rounded bg-blue-500 text-white font-bold cursor-pointer hover:bg-blue-600">Save</button>
        <button id="loadTab"
          class="py-1 px-2.5 border-none rounded bg-blue-500 text-white font-bold cursor-pointer hover:bg-blue-600">Load</button>
        <button id="printTab"
          class="py-1 px-2.5 border-none rounded bg-blue-500 text-white font-bold cursor-pointer hover:bg-blue-600">Print</button>
        <button id="newSection"
          class="py-1 px-2.5 border-none rounded bg-blue-500 text-white font-bold cursor-pointer hover:bg-blue-600">New
          Section</button>
      </div>

      <div class="toolbar-group flex gap-2.5 items-center">
        <small class="text-gray-300">Navigate: ↑↓←→ | Exit: Esc</small>
      </div>
    </div>

    <div
      class="tab-editor p-4 min-h-[500px] max-w-[8.5in] font-mono break-words mx-auto"
      id="tabEditor">
      <!-- Tab content will be generated here -->
    </div>
  </div>

  <script>
    class GuitarTabber {
      constructor() {
        this.stringCount = 6;
        this.fontSize = 14;
        this.selectedChar = null;
        this.editMode = false;
        this.tabs = {}; // In-memory storage (replace with localStorage later)
        this.currentTabId = 'default';

        this.standardTunings = {
          4: ['G', 'D', 'A', 'E'],
          5: ['B', 'E', 'A', 'D', 'G'],
          6: ['E', 'A', 'D', 'G', 'B', 'E'],
          7: ['B', 'E', 'A', 'D', 'G', 'B', 'E'],
          8: ['F#', 'B', 'E', 'A', 'D', 'G', 'B', 'E']
        };

        this.init();
        this.generateDefaultTab();
      }

      init() {
        // Event listeners
        document.getElementById('stringCount').addEventListener('change', (e) => {
          this.stringCount = parseInt(e.target.value);
          this.generateDefaultTab();
        });

        document.getElementById('fontSize').addEventListener('change', (e) => {
          this.fontSize = parseInt(e.target.value);
          document.getElementById('tabEditor').style.fontSize = e.target.value + 'pt';
        });

        document.getElementById('saveTab').addEventListener('click', () => this.saveTab());
        document.getElementById('loadTab').addEventListener('click', () => this.loadTab());
        document.getElementById('printTab').addEventListener('click', () => window.print());
        document.getElementById('newSection').addEventListener('click', () => this.addNewSection());

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          // Navigation keys
          if (this.editMode && this.selectedChar) {
            let handled = false;

            switch (e.key.toLowerCase()) {
              case 'arrowleft':
              case 'a':
                this.navigate('left');
                handled = true;
                break;
              case 'arrowright':
              case 'd':
                this.navigate('right');
                handled = true;
                break;
              case 'arrowup':
              case 'w':
                this.navigate('up');
                handled = true;
                break;
              case 'arrowdown':
              case 's':
                this.navigate('down');
                handled = true;
                break;
            }

            if (handled) {
              e.preventDefault();
            }
          }
        });

        // Click handling for editable characters
        document.getElementById('tabEditor').addEventListener('click', (e) => {
          if (e.target.classList.contains('tab-char')) {
            this.selectCharacter(e.target);
            this.editMode = true;
          } else {
            // Click outside tab characters exits edit mode
            this.exitEditMode();
          }
        });

        // Click outside editor exits edit mode
        document.addEventListener('click', (e) => {
          if (!document.getElementById('tabEditor').contains(e.target)) {
            this.exitEditMode();
          }
        });

        // Character input
        document.addEventListener('keypress', (e) => {
          if (this.editMode && this.selectedChar && e.key.length === 1) {
            e.preventDefault();
            this.replaceSelectedChar(e.key);
          }
        });

        // Escape key exits edit mode
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.exitEditMode();
          }
        });
      }

      generateDefaultTab() {
        const editor = document.getElementById('tabEditor');
        const tuning = this.standardTunings[this.stringCount];

        editor.innerHTML = this.createTabSection('Verse 1: Enter your lyrics here', 'C        G        Am       F');

        // Auto-select first tab character for immediate keyboard navigation
        setTimeout(() => {
          const firstTabChar = editor.querySelector('.tab-char');
          if (firstTabChar) {
            this.selectCharacter(firstTabChar);
            this.editMode = true;
          }
        }, 100);
      }

      createTabSection(lyrics = '', chords = '') {
        const tuning = this.standardTunings[this.stringCount];
        let html = '<div class="mb-5">';

        // Lyrics line
        html += `<div class="text-slate-700 mb-1 min-h-[1.2em] cursor-text" contenteditable="true">${lyrics}</div>`;

        // Chords line  
        html += `<div class="text-red-600 font-bold mb-1 min-h-[1.2em] cursor-text" contenteditable="true">${chords}</div>`;

        // Tab lines
        tuning.forEach((note, index) => {
          const reversedIndex = tuning.length - 1 - index; // Reverse for standard display
          const displayNote = tuning[reversedIndex];
          html += `<div class="tabline text-green-600 mb-0.5 cursor-text min-h-[1.2em]">`;
          html += `<span class="text-gray-500 mr-1">${displayNote}|</span>`;

          // Generate dashes for the tab line (about 60 characters to fit letter size)
          for (let i = 0; i < 60; i++) {
            html += `<span class="tab-char">-</span>`;
          }
          html += `|`;
          html += `</div>`;
        });

        html += '</div>';
        return html;
      }

      selectCharacter(charElement) {
        // Clear previous selection
        if (this.selectedChar) {
          this.selectedChar.classList.remove('editable-char');
        }

        // Select new character
        this.selectedChar = charElement;
        charElement.classList.add('editable-char');
      }

      exitEditMode() {
        if (this.selectedChar) {
          this.selectedChar.classList.remove('editable-char');
          this.selectedChar = null;
        }
        this.editMode = false;
      }

      replaceSelectedChar(newChar) {
        if (this.selectedChar) {
          this.selectedChar.textContent = newChar;
          // Keep character selected and stay in edit mode
        }
      }

      navigate(direction) {
        if (!this.selectedChar) return;

        const allTabChars = Array.from(document.querySelectorAll('.tab-char'));
        const currentIndex = allTabChars.indexOf(this.selectedChar);

        if (currentIndex === -1) return;

        let targetIndex = currentIndex;
        const tabLines = document.querySelectorAll('.tabline');
        const charsPerLine = Math.floor(allTabChars.length / tabLines.length);

        switch (direction) {
          case 'left':
            targetIndex = Math.max(0, currentIndex - 1);
            break;
          case 'right':
            targetIndex = Math.min(allTabChars.length - 1, currentIndex + 1);
            break;
          case 'up':
            targetIndex = Math.max(0, currentIndex - charsPerLine);
            break;
          case 'down':
            targetIndex = Math.min(allTabChars.length - 1, currentIndex + charsPerLine);
            break;
        }

        if (targetIndex !== currentIndex && allTabChars[targetIndex]) {
          this.selectCharacter(allTabChars[targetIndex]);
        }
      }

      addNewSection() {
        const editor = document.getElementById('tabEditor');
        const newSection = document.createElement('div');
        newSection.innerHTML = this.createTabSection('New section: Enter lyrics here', 'C        G        Am       F');
        editor.appendChild(newSection);
      }

      saveTab() {
        const content = document.getElementById('tabEditor').innerHTML;
        const tabName = prompt('Enter tab name:', 'My Tab');
        if (tabName) {
          this.tabs[tabName] = content;
          alert(`Tab "${tabName}" saved!`);
        }
      }

      loadTab() {
        const tabNames = Object.keys(this.tabs);
        if (tabNames.length === 0) {
          alert('No saved tabs found.');
          return;
        }

        const tabName = prompt(`Enter tab name to load:\nAvailable: ${tabNames.join(', ')}`);
        if (tabName && this.tabs[tabName]) {
          document.getElementById('tabEditor').innerHTML = this.tabs[tabName];
          alert(`Tab "${tabName}" loaded!`);
        } else if (tabName) {
          alert('Tab not found.');
        }
      }
    }

    // Initialize the app
    new GuitarTabber();
  </script>


</body>

</html>